[{"data":1,"prerenderedAt":354},["ShallowReactive",2],{"article-homelab-v2":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"category":10,"date":11,"body":12,"_type":348,"_id":349,"_source":350,"_file":351,"_stem":352,"_extension":353},"/articles/homelab-v2","articles",false,"","HomeLab v2.0 架構大遷移：告別存算分離，擁抱 Ubuntu + ZFS + AI Copilot 全能單機","告別存算分離，擁抱 Ubuntu + ZFS + Cockpit + AI Copilot 的全能單機 HomeLab v2.0 架構分享。","server","2026-02-14",{"type":13,"children":14,"toc":345},"root",[15,24,30,35,61,73,84,90,101,113,119,138,150,156,161,185,197,203,208,230,248,260,293,320,325,330,335,340],{"type":16,"tag":17,"props":18,"children":20},"element","h1",{"id":19},"前言為什麼要重構",[21],{"type":22,"value":23},"text","前言：為什麼要重構？",{"type":16,"tag":25,"props":26,"children":27},"p",{},[28],{"type":22,"value":29},"熟悉我的朋友都知道，我的上一代 HomeLab (v1) 是一個經典的「存算分離」架構。那時候為了追求所謂的 Enterprise-grade（企業級）配置，我把儲存交給了 TrueNAS，運算則由 Proxmox VE (PVE) 負責，兩者透過網路協定連接。",{"type":16,"tag":25,"props":31,"children":32},{},[33],{"type":22,"value":34},"看起來很美好，對吧？但隨著時間推移，現實的「維護成本」狠狠地打醒了我：",{"type":16,"tag":36,"props":37,"children":38},"ol",{},[39,51],{"type":16,"tag":40,"props":41,"children":42},"li",{},[43,49],{"type":16,"tag":44,"props":45,"children":46},"strong",{},[47],{"type":22,"value":48},"功耗焦慮",{"type":22,"value":50},"：為了這個分離架構，我必須維持多台機器運作。看著電費單，我不禁懷疑：對於現在的負載需求，真的需要兩台機器空轉嗎？",{"type":16,"tag":40,"props":52,"children":53},{},[54,59],{"type":16,"tag":44,"props":55,"children":56},{},[57],{"type":22,"value":58},"維護黑洞",{"type":22,"value":60},"：PVE 的 FreeNAS (TrueNAS) 儲存模組近年來維護狀況不佳，每次升級都像是在走鋼索，一旦 connection 出問題，整個 VM Cluster 就癱瘓。",{"type":16,"tag":25,"props":62,"children":63},{},[64,66,71],{"type":22,"value":65},"於是，我決定進行一場徹底的「斷捨離」。我的需求已經變了，不再需要多機備援的複雜度。是時候回歸本質：",{"type":16,"tag":44,"props":67,"children":68},{},[69],{"type":22,"value":70},"高效、單機、智慧化",{"type":22,"value":72},"。",{"type":16,"tag":25,"props":74,"children":75},{},[76,78,83],{"type":22,"value":77},"歡迎來到我的 ",{"type":16,"tag":44,"props":79,"children":80},{},[81],{"type":22,"value":82},"HomeLab v2.0",{"type":22,"value":72},{"type":16,"tag":17,"props":85,"children":87},{"id":86},"核心思想一化繁為簡hybrid-all-in-one",[88],{"type":22,"value":89},"核心思想一：化繁為簡，Hybrid All-in-One",{"type":16,"tag":25,"props":91,"children":92},{},[93,95,100],{"type":22,"value":94},"v2 的首要目標只有一個：",{"type":16,"tag":44,"props":96,"children":97},{},[98],{"type":22,"value":99},"存算一體 (Hybrid Storage/VM/Container)",{"type":22,"value":72},{"type":16,"tag":25,"props":102,"children":103},{},[104,106,111],{"type":22,"value":105},"我拋棄了專用的儲存 OS 和虛擬化 OS，轉而採用通用性最強的 ",{"type":16,"tag":44,"props":107,"children":108},{},[109],{"type":22,"value":110},"Ubuntu",{"type":22,"value":112}," 作為基底。這不僅大幅降低了硬體需求和功耗，更讓我擁有對系統底層由上到下完整的控制權。不需要再煩惱跨機器的 iSCSI 或 NFS 延遲，所有的 I/O 都在本機內完成，速度飛快且穩定。",{"type":16,"tag":17,"props":114,"children":116},{"id":115},"核心思想二ubuntu-zfs-cockpit-的黃金三角",[117],{"type":22,"value":118},"核心思想二：Ubuntu + ZFS + Cockpit 的黃金三角",{"type":16,"tag":25,"props":120,"children":121},{},[122,124,129,131,136],{"type":22,"value":123},"在作業系統層，我選擇了 ",{"type":16,"tag":44,"props":125,"children":126},{},[127],{"type":22,"value":128},"Ubuntu Server",{"type":22,"value":130}," 搭配 ",{"type":16,"tag":44,"props":132,"children":133},{},[134],{"type":22,"value":135},"ZFS",{"type":22,"value":137},"。\nZFS 的強大無須多言（Snapshot, Compression, ARC），在 Ubuntu 上它的支援度極高。",{"type":16,"tag":25,"props":139,"children":140},{},[141,143,148],{"type":22,"value":142},"而在管理介面方面，我沒有選擇厚重的 Web 介面，而是選擇了 ",{"type":16,"tag":44,"props":144,"children":145},{},[146],{"type":22,"value":147},"Cockpit",{"type":22,"value":149},"。\nCockpit 非常輕量，它忠實地反應了 Linux 系統的狀態，不會像某些管理面板一樣在背後魔改系統設定檔。這讓我在享受 Web UI 便利的同時，依然能保留隨時切回 Terminal 手動操作的彈性。",{"type":16,"tag":17,"props":151,"children":153},{"id":152},"核心思想三徹底的-rootless-vm-container",[154],{"type":22,"value":155},"核心思想三：徹底的 Rootless (VM & Container)",{"type":16,"tag":25,"props":157,"children":158},{},[159],{"type":22,"value":160},"安全性與隔離性是 v2 架構的另一個重點。在 Cockpit 上，我充分利用了現有的 Plugin 體系：",{"type":16,"tag":162,"props":163,"children":164},"ul",{},[165,175],{"type":16,"tag":40,"props":166,"children":167},{},[168,173],{"type":16,"tag":44,"props":169,"children":170},{},[171],{"type":22,"value":172},"Virtual Machines (libvirt)",{"type":22,"value":174},"：用於運行需要完整 OS 的服務。",{"type":16,"tag":40,"props":176,"children":177},{},[178,183],{"type":16,"tag":44,"props":179,"children":180},{},[181],{"type":22,"value":182},"Containers (Podman)",{"type":22,"value":184},"：用於運行輕量級應用。",{"type":16,"tag":25,"props":186,"children":187},{},[188,190,195],{"type":22,"value":189},"最關鍵的是，我全面採用了 ",{"type":16,"tag":44,"props":191,"children":192},{},[193],{"type":22,"value":194},"Rootless",{"type":22,"value":196}," 方案。\n這意味著不管是 libvirt 還是 Podman，都是以非 root 使用者身份運行。這在安全性上是一個巨大的提升，即使容器被攻破，攻擊者拿到的權限也受到極大限制。Cockpit 對 Rootless 的支援相當完善，讓我可以在 Web 介面上無痛管理這些隔離環境。",{"type":16,"tag":17,"props":198,"children":200},{"id":199},"核心思想四注入靈魂-cockpit-copilot-llm-mcp",[201],{"type":22,"value":202},"核心思想四：注入靈魂 —— Cockpit Copilot (LLM + MCP)",{"type":16,"tag":25,"props":204,"children":205},{},[206],{"type":22,"value":207},"這大概是 v2 架構最「Geek」也最讓我興奮的部分。",{"type":16,"tag":25,"props":209,"children":210},{},[211,213,220,222,228],{"type":22,"value":212},"光有好的架構還不夠，我希望管理伺服器這件事能更「現代化」。既然 LLM 這麼強大，為什麼我要自己去查 ",{"type":16,"tag":214,"props":215,"children":217},"code",{"className":216},[],[218],{"type":22,"value":219},"virsh",{"type":22,"value":221}," 或 ",{"type":16,"tag":214,"props":223,"children":225},{"className":224},[],[226],{"type":22,"value":227},"podman",{"type":22,"value":229}," 的冷門參數？",{"type":16,"tag":25,"props":231,"children":232},{},[233,235,247],{"type":22,"value":234},"於是，我自製了一個專案：",{"type":16,"tag":44,"props":236,"children":237},{},[238],{"type":16,"tag":239,"props":240,"children":244},"a",{"href":241,"rel":242},"https://github.com/hans00/cockpit-copilot-agent",[243],"nofollow",[245],{"type":22,"value":246},"cockpit-copilot-agent",{"type":22,"value":72},{"type":16,"tag":25,"props":249,"children":250},{},[251,253,258],{"type":22,"value":252},"這不只是一個聊天機器人，這是基於 ",{"type":16,"tag":44,"props":254,"children":255},{},[256],{"type":22,"value":257},"MCP (Model Context Protocol)",{"type":22,"value":259}," 打造的系統管理員助手：",{"type":16,"tag":36,"props":261,"children":262},{},[263,273,283],{"type":16,"tag":40,"props":264,"children":265},{},[266,271],{"type":16,"tag":44,"props":267,"children":268},{},[269],{"type":22,"value":270},"MCP 工具包",{"type":22,"value":272},"：我將 Linux 系統管理工具封裝成 MCP tools。",{"type":16,"tag":40,"props":274,"children":275},{},[276,281],{"type":16,"tag":44,"props":277,"children":278},{},[279],{"type":22,"value":280},"LLM 決策",{"type":22,"value":282},"：透過語言模型理解我的自然語言指令（例如：「幫我把那個吃記憶體最兇的 Container 重啟」）。",{"type":16,"tag":40,"props":284,"children":285},{},[286,291],{"type":16,"tag":44,"props":287,"children":288},{},[289],{"type":22,"value":290},"自動執行",{"type":22,"value":292},"：Agent 會透過 MCP 安全地調用系統指令，並將結果回傳給我。",{"type":16,"tag":25,"props":294,"children":295},{},[296,298,304,306,312,314,319],{"type":22,"value":297},"以前我要 SSH 進去敲 ",{"type":16,"tag":214,"props":299,"children":301},{"className":300},[],[302],{"type":22,"value":303},"podman stats",{"type":22,"value":305}," 然後 ",{"type":16,"tag":214,"props":307,"children":309},{"className":308},[],[310],{"type":22,"value":311},"podman restart \u003Cid>",{"type":22,"value":313},"，現在我只需要在 Cockpit 裡跟我的 Copilot 說一句話。它不僅是介面，更是我的 ",{"type":16,"tag":44,"props":315,"children":316},{},[317],{"type":22,"value":318},"Sidecar Admin",{"type":22,"value":72},{"type":16,"tag":321,"props":322,"children":324},"vue-mermaid",{"code":323},"\ngraph TD\n User((User)) -->|Natural Language| Agent[Cockpit Copilot Agent]\n Agent -->|MCP Protocol| Tools[MCP Tools]\n Tools -->|Command| System[Ubuntu System]\n System --> Podman\n System --> Libvirt\n System --> ZFS\n subgraph Cockpit\n     Agent\n end\n",[],{"type":16,"tag":17,"props":326,"children":328},{"id":327},"結語",[329],{"type":22,"value":327},{"type":16,"tag":25,"props":331,"children":332},{},[333],{"type":22,"value":334},"HomeLab v2.0 不僅是一次硬體架構的縮減，更是一次管理思維的升級。",{"type":16,"tag":25,"props":336,"children":337},{},[338],{"type":22,"value":339},"從「多機堆疊」回歸到「單機極致」，從「手動維護」進化到「AI 輔助」。這套 Ubuntu + ZFS + Cockpit + AI Copilot 的組合，完美解決了我舊架構的功耗痛點，同時也讓系統管理變得前所未有的有趣。",{"type":16,"tag":25,"props":341,"children":342},{},[343],{"type":22,"value":344},"如果你也厭倦了維護龐大虛擬化叢集的疲憊感，或許這套 All-in-One 的智慧化方案，會是你下一個 HomeLab 的靈感來源。",{"title":7,"searchDepth":346,"depth":346,"links":347},2,[],"markdown","content:articles:homelab-v2.md","content","articles/homelab-v2.md","articles/homelab-v2","md",1771108310340]