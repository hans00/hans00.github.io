{"generatedAt":1771108032747,"generateTime":196,"contents":[{"_path":"/about-me","_dir":"","_draft":false,"_partial":false,"_locale":"","titles":["Member of 社團法人臺灣校園資訊安全推廣暨駭客培育協會"],"experiences":[{"year":2013,"content":"Won the Taiwan local LEGO WRO contest."},{"year":2014,"content":"Manage shared hosting server."},{"year":2015,"content":"Work for RemoteSpark Inc."},{"year":2016,"content":"Won the self-drive car contest. (Arduino)"},{"year":2018,"content":"Work for Leukocyte Lab Co., Ltd."},{"year":2018,"content":[{"text":"Found some vulnerability on 4G portable modem"},{"link":{"text":"(PoC)","url":"https://zeroday.hitcon.org/vulnerability/ZD-2018-01054"}}]}],"projects":[{"name":"My LHU","link":"https://github.com/hans00/MyLHU","badges":[{"text":"Not In Maintain","color":"orange"}],"description":"A tool for LHU students.\nUsing Node.js and Vue.js. And user data only in session."},{"name":"envoy ModSecurity","link":"https://github.com/hans00/ModSecurity-envoy","description":"ModSecurity filter for envoy proxy.\nI'm reasearching for high performance reverse proxy and WAF solution.\nBut original repository seems not in maintain, so I forked."},{"name":"Fast WS","link":"https://github.com/hans00/fastWS","badges":[{"text":"WIP","color":"yellow"}],"description":"A high-performance HTTP server.\nUsing uWebSockets. And the HTTP API compatible Express.js."},{"image":"https://upload.wikimedia.org/wikipedia/commons/thumb/9/98/WordPress_blue_logo.svg/240px-WordPress_blue_logo.svg.png","name":"WordPress Optimization","link":"https://github.com/hans00/WordPress_Optimization","description":"Trying to optomize WordPress.\nProvide two solution.\n- Ngingx with PHP-FPM, Redis and MariaDB\n- OpenLiteSpeed with Redis and MariaDB"}],"_id":"content:about-me.json","_type":"json","title":"About Me","_source":"content","_file":"about-me.json","_stem":"about-me","_extension":"json"},{"_path":"/articles/home-lab","_dir":"articles","_draft":false,"_partial":false,"_locale":"","title":"我的 home lab","description":"我的自管伺服器的架構與解決辦法","category":"server","date":"2022-01-01","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"實體機架構"},"children":[{"type":"text","value":"實體機架構"}]},{"type":"element","tag":"vue-mermaid","props":{"code":"\ngraph LR\n isp(ISP) --- router\n router((路由器)) --- storage & vm-server & home\n home[Home Group]\n subgraph Server Group\n     storage[儲存] == Fiber === vm-server\n     subgraph DMZ\n         vm-server[VM]\n     end\n end\n"},"children":[]},{"type":"element","tag":"h2","props":{"id":"路由器"},"children":[{"type":"text","value":"路由器"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我採用了 RouterOS，因為可以使用相對低的成本做到專業路由器的設定。"}]},{"type":"element","tag":"h2","props":{"id":"儲存"},"children":[{"type":"text","value":"儲存"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在眾多專為儲存設計的作業系統中我最終採用 DIY 建置的方案。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Debian\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"XanMod kernel LTS"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"OpenZFS"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"iSCSI: LIO"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Cockpit\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/optimans/cockpit-zfs-manager","rel":["nofollow"]},"children":[{"type":"text","value":"ZFS Manager"}]}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"原本是想選擇 FreeNAS，畢竟 iXsystems 在 FreeNAS 上做了不少優化。但 FreeBSD 的社群正在萎縮、維護速度趕不上 Linux。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"使用 XanMod kernel 是因為在加上 performance profile 之後擁有更佳的性能。\n而 iSCSI 採用 LIO 是因為它是執行在 kernel 內、支援各種協定，且它可以直接與 Proxmox VE 整合 (ZFS over iSCSI)。"}]},{"type":"element","tag":"h3","props":{"id":"openzfs"},"children":[{"type":"text","value":"OpenZFS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"非常強大，支援快照、區塊壓縮、RAM cache (ARC)、SSD cache (L2ARC) 等功能，且自有的 zpool 管理方式非常方便。"}]},{"type":"element","tag":"h3","props":{"id":"cockpit"},"children":[{"type":"text","value":"Cockpit"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"近期社群非常活躍的 Web 管理介面專案，它可以很容易的安裝第三方插件。"}]},{"type":"element","tag":"h2","props":{"id":"vm"},"children":[{"type":"text","value":"VM"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我選擇了 Proxmox VE，因為它是開源的而且有非常方便管理的 Web UI。\n並且由於該主機是自組的、沒有辦法放那麼多硬碟，所以我把儲存分離出去，為了保障資料傳輸還設定了直連光纖。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"所有的應用服務都是在這台上面開 LXC 或 VM 來解決。"}]},{"type":"element","tag":"h2","props":{"id":"分區管制"},"children":[{"type":"text","value":"分區管制"}]},{"type":"element","tag":"h3","props":{"id":"home-group"},"children":[{"type":"text","value":"Home group"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"供給家裡使用，設定 DHCP 與 NAT 且獨立的網段。"}]},{"type":"element","tag":"h3","props":{"id":"server-group"},"children":[{"type":"text","value":"Server group"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"供給伺服器使用，獨立的網段且有分區管制，僅 PVE 內。"}]},{"type":"element","tag":"h1","props":{"id":"應用層架構"},"children":[{"type":"text","value":"應用層架構"}]},{"type":"element","tag":"vue-mermaid","props":{"code":"\ngraph TB\n envoy -- WAF --> iis & http1 & http2\n envoy --> other-services\n rdp-proxy --> rdp & vnc\n subgraph front-vm [Bastion host VM]\n     envoy(envoy proxy)\n     rdp-proxy(RDP proxy)\n end\n subgraph windows-vm [Windows VM]\n     rdp(RDP)\n     iis(IIS)\n end\n subgraph linux-1 [Linux VM 1]\n     vnc(VNC)\n     http1(HTTP)\n end\n subgraph linux-2 [Linux VM 2]\n     http2(HTTP)\n end\n subgraph linux-3 [Linux VM 3]\n     other-services(Other services)\n end\n"},"children":[]},{"type":"element","tag":"h2","props":{"id":"bastion-host"},"children":[{"type":"text","value":"Bastion host"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"採用類似雲端的管理方式，由 bastion host 統一對外。"}]},{"type":"element","tag":"h3","props":{"id":"envoy-proxy"},"children":[{"type":"text","value":"envoy proxy"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"envoy proxy 是 CNCF 的一個專案，就是專門進行高效能代理服務用的伺服器。"}]},{"type":"element","tag":"h4","props":{"id":"modsecurity-filter"},"children":[{"type":"text","value":"ModSecurity filter"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"為了安全性，我在 HTTP 服務加上 ModSecurity filter 作為 WAF。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這個模組雖然有找到現成的，但似乎有段時間沒維護且留下了一些 TODO code，所以我花了時間整理了一下。envoy proxy 內部程式碼似乎沒有文件，於是我是一層一層追蹤來找到正確寫法的。"}]},{"type":"element","tag":"h3","props":{"id":"rdp-proxy"},"children":[{"type":"text","value":"RDP proxy"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我找到了 "},{"type":"element","tag":"a","props":{"href":"https://github.com/wallix/redemption","rel":["nofollow"]},"children":[{"type":"text","value":"redemption"}]},{"type":"text","value":" 這個專案可以在 Linux 上建置統一對外用的 proxy，所以我選用這個並依他的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"passthrough.py"}]},{"type":"text","value":" 範本加寫了限制連線範圍的規則。"}]},{"type":"element","tag":"h4","props":{"id":"auto-ban"},"children":[{"type":"text","value":"auto ban"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"passthrough.py"}]},{"type":"text","value":" 這邊辨識連線目標為範圍外時會記錄下來，再透過 fail2ban 進行封鎖。"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"路由器","depth":2,"text":"路由器"},{"id":"儲存","depth":2,"text":"儲存","children":[{"id":"openzfs","depth":3,"text":"OpenZFS"},{"id":"cockpit","depth":3,"text":"Cockpit"}]},{"id":"vm","depth":2,"text":"VM"},{"id":"分區管制","depth":2,"text":"分區管制","children":[{"id":"home-group","depth":3,"text":"Home group"},{"id":"server-group","depth":3,"text":"Server group"}]},{"id":"bastion-host","depth":2,"text":"Bastion host","children":[{"id":"envoy-proxy","depth":3,"text":"envoy proxy"},{"id":"rdp-proxy","depth":3,"text":"RDP proxy"}]}]}},"_type":"markdown","_id":"content:articles:home-lab.md","_source":"content","_file":"articles/home-lab.md","_stem":"articles/home-lab","_extension":"md"},{"_path":"/articles/homelab-v2","_dir":"articles","_draft":false,"_partial":false,"_locale":"","title":"HomeLab v2.0 架構大遷移：告別存算分離，擁抱 Ubuntu + ZFS + AI Copilot 全能單機","description":"告別存算分離，擁抱 Ubuntu + ZFS + Cockpit + AI Copilot 的全能單機 HomeLab v2.0 架構分享。","category":"server","date":"2024-02-14","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"前言為什麼要重構"},"children":[{"type":"text","value":"前言：為什麼要重構？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"熟悉我的朋友都知道，我的上一代 HomeLab (v1) 是一個經典的「存算分離」架構。那時候為了追求所謂的 Enterprise-grade（企業級）配置，我把儲存交給了 TrueNAS，運算則由 Proxmox VE (PVE) 負責，兩者透過網路協定連接。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"看起來很美好，對吧？但隨著時間推移，現實的「維護成本」狠狠地打醒了我："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"功耗焦慮"}]},{"type":"text","value":"：為了這個分離架構，我必須維持多台機器運作。看著電費單，我不禁懷疑：對於現在的負載需求，真的需要兩台機器空轉嗎？"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"維護黑洞"}]},{"type":"text","value":"：PVE 的 FreeNAS (TrueNAS) 儲存模組近年來維護狀況不佳，每次升級都像是在走鋼索，一旦 connection 出問題，整個 VM Cluster 就癱瘓。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"於是，我決定進行一場徹底的「斷捨離」。我的需求已經變了，不再需要多機備援的複雜度。是時候回歸本質："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"高效、單機、智慧化"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"歡迎來到我的 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"HomeLab v2.0"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"h1","props":{"id":"核心思想一化繁為簡hybrid-all-in-one"},"children":[{"type":"text","value":"核心思想一：化繁為簡，Hybrid All-in-One"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"v2 的首要目標只有一個："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"存算一體 (Hybrid Storage/VM/Container)"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我拋棄了專用的儲存 OS 和虛擬化 OS，轉而採用通用性最強的 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ubuntu"}]},{"type":"text","value":" 作為基底。這不僅大幅降低了硬體需求和功耗，更讓我擁有對系統底層由上到下完整的控制權。不需要再煩惱跨機器的 iSCSI 或 NFS 延遲，所有的 I/O 都在本機內完成，速度飛快且穩定。"}]},{"type":"element","tag":"h1","props":{"id":"核心思想二ubuntu-zfs-cockpit-的黃金三角"},"children":[{"type":"text","value":"核心思想二：Ubuntu + ZFS + Cockpit 的黃金三角"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在作業系統層，我選擇了 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ubuntu Server"}]},{"type":"text","value":" 搭配 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"ZFS"}]},{"type":"text","value":"。\nZFS 的強大無須多言（Snapshot, Compression, ARC），在 Ubuntu 上它的支援度極高。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"而在管理介面方面，我沒有選擇厚重的 Web 介面，而是選擇了 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Cockpit"}]},{"type":"text","value":"。\nCockpit 非常輕量，它忠實地反應了 Linux 系統的狀態，不會像某些管理面板一樣在背後魔改系統設定檔。這讓我在享受 Web UI 便利的同時，依然能保留隨時切回 Terminal 手動操作的彈性。"}]},{"type":"element","tag":"h1","props":{"id":"核心思想三徹底的-rootless-vm-container"},"children":[{"type":"text","value":"核心思想三：徹底的 Rootless (VM & Container)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安全性與隔離性是 v2 架構的另一個重點。在 Cockpit 上，我充分利用了現有的 Plugin 體系："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Virtual Machines (libvirt)"}]},{"type":"text","value":"：用於運行需要完整 OS 的服務。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Containers (Podman)"}]},{"type":"text","value":"：用於運行輕量級應用。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最關鍵的是，我全面採用了 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Rootless"}]},{"type":"text","value":" 方案。\n這意味著不管是 libvirt 還是 Podman，都是以非 root 使用者身份運行。這在安全性上是一個巨大的提升，即使容器被攻破，攻擊者拿到的權限也受到極大限制。Cockpit 對 Rootless 的支援相當完善，讓我可以在 Web 介面上無痛管理這些隔離環境。"}]},{"type":"element","tag":"h1","props":{"id":"核心思想四注入靈魂-cockpit-copilot-llm-mcp"},"children":[{"type":"text","value":"核心思想四：注入靈魂 —— Cockpit Copilot (LLM + MCP)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這大概是 v2 架構最「Geek」也最讓我興奮的部分。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"光有好的架構還不夠，我希望管理伺服器這件事能更「現代化」。既然 LLM 這麼強大，為什麼我要自己去查 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"virsh"}]},{"type":"text","value":" 或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"podman"}]},{"type":"text","value":" 的冷門參數？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"於是，我自製了一個專案："},{"type":"element","tag":"strong","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/hans00/cockpit-copilot-agent","rel":["nofollow"]},"children":[{"type":"text","value":"cockpit-copilot-agent"}]}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這不只是一個聊天機器人，這是基於 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"MCP (Model Context Protocol)"}]},{"type":"text","value":" 打造的系統管理員助手："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"MCP 工具包"}]},{"type":"text","value":"：我將 Linux 系統管理工具封裝成 MCP tools。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"LLM 決策"}]},{"type":"text","value":"：透過語言模型理解我的自然語言指令（例如：「幫我把那個吃記憶體最兇的 Container 重啟」）。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"自動執行"}]},{"type":"text","value":"：Agent 會透過 MCP 安全地調用系統指令，並將結果回傳給我。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"以前我要 SSH 進去敲 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"podman stats"}]},{"type":"text","value":" 然後 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"podman restart <id>"}]},{"type":"text","value":"，現在我只需要在 Cockpit 裡跟我的 Copilot 說一句話。它不僅是介面，更是我的 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Sidecar Admin"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"vue-mermaid","props":{"code":"\ngraph TD\n User((User)) -->|Natural Language| Agent[Cockpit Copilot Agent]\n Agent -->|MCP Protocol| Tools[MCP Tools]\n Tools -->|Command| System[Ubuntu System]\n System --> Podman\n System --> Libvirt\n System --> ZFS\n subgraph Cockpit\n     Agent\n end\n"},"children":[]},{"type":"element","tag":"h1","props":{"id":"結語"},"children":[{"type":"text","value":"結語"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"HomeLab v2.0 不僅是一次硬體架構的縮減，更是一次管理思維的升級。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"從「多機堆疊」回歸到「單機極致」，從「手動維護」進化到「AI 輔助」。這套 Ubuntu + ZFS + Cockpit + AI Copilot 的組合，完美解決了我舊架構的功耗痛點，同時也讓系統管理變得前所未有的有趣。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果你也厭倦了維護龐大虛擬化叢集的疲憊感，或許這套 All-in-One 的智慧化方案，會是你下一個 HomeLab 的靈感來源。"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:articles:homelab-v2.md","_source":"content","_file":"articles/homelab-v2.md","_stem":"articles/homelab-v2","_extension":"md"}],"navigation":[{"title":"About Me","_path":"/about-me"},{"title":"Articles","_path":"/articles","children":[{"title":"我的 home lab","_path":"/articles/home-lab"},{"title":"HomeLab v2.0 架構大遷移：告別存算分離，擁抱 Ubuntu + ZFS + AI Copilot 全能單機","_path":"/articles/homelab-v2"}]}]}