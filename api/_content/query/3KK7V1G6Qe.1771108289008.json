{"_path":"/articles/homelab-v2","_dir":"articles","_draft":false,"_partial":false,"_locale":"","title":"HomeLab v2.0 架構大遷移：告別存算分離，擁抱 Ubuntu + ZFS + AI Copilot 全能單機","description":"告別存算分離，擁抱 Ubuntu + ZFS + Cockpit + AI Copilot 的全能單機 HomeLab v2.0 架構分享。","category":"server","date":"2026-02-14","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"前言為什麼要重構"},"children":[{"type":"text","value":"前言：為什麼要重構？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"熟悉我的朋友都知道，我的上一代 HomeLab (v1) 是一個經典的「存算分離」架構。那時候為了追求所謂的 Enterprise-grade（企業級）配置，我把儲存交給了 TrueNAS，運算則由 Proxmox VE (PVE) 負責，兩者透過網路協定連接。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"看起來很美好，對吧？但隨著時間推移，現實的「維護成本」狠狠地打醒了我："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"功耗焦慮"}]},{"type":"text","value":"：為了這個分離架構，我必須維持多台機器運作。看著電費單，我不禁懷疑：對於現在的負載需求，真的需要兩台機器空轉嗎？"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"維護黑洞"}]},{"type":"text","value":"：PVE 的 FreeNAS (TrueNAS) 儲存模組近年來維護狀況不佳，每次升級都像是在走鋼索，一旦 connection 出問題，整個 VM Cluster 就癱瘓。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"於是，我決定進行一場徹底的「斷捨離」。我的需求已經變了，不再需要多機備援的複雜度。是時候回歸本質："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"高效、單機、智慧化"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"歡迎來到我的 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"HomeLab v2.0"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"h1","props":{"id":"核心思想一化繁為簡hybrid-all-in-one"},"children":[{"type":"text","value":"核心思想一：化繁為簡，Hybrid All-in-One"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"v2 的首要目標只有一個："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"存算一體 (Hybrid Storage/VM/Container)"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我拋棄了專用的儲存 OS 和虛擬化 OS，轉而採用通用性最強的 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ubuntu"}]},{"type":"text","value":" 作為基底。這不僅大幅降低了硬體需求和功耗，更讓我擁有對系統底層由上到下完整的控制權。不需要再煩惱跨機器的 iSCSI 或 NFS 延遲，所有的 I/O 都在本機內完成，速度飛快且穩定。"}]},{"type":"element","tag":"h1","props":{"id":"核心思想二ubuntu-zfs-cockpit-的黃金三角"},"children":[{"type":"text","value":"核心思想二：Ubuntu + ZFS + Cockpit 的黃金三角"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在作業系統層，我選擇了 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ubuntu Server"}]},{"type":"text","value":" 搭配 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"ZFS"}]},{"type":"text","value":"。\nZFS 的強大無須多言（Snapshot, Compression, ARC），在 Ubuntu 上它的支援度極高。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"而在管理介面方面，我沒有選擇厚重的 Web 介面，而是選擇了 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Cockpit"}]},{"type":"text","value":"。\nCockpit 非常輕量，它忠實地反應了 Linux 系統的狀態，不會像某些管理面板一樣在背後魔改系統設定檔。這讓我在享受 Web UI 便利的同時，依然能保留隨時切回 Terminal 手動操作的彈性。"}]},{"type":"element","tag":"h1","props":{"id":"核心思想三徹底的-rootless-vm-container"},"children":[{"type":"text","value":"核心思想三：徹底的 Rootless (VM & Container)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安全性與隔離性是 v2 架構的另一個重點。在 Cockpit 上，我充分利用了現有的 Plugin 體系："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Virtual Machines (libvirt)"}]},{"type":"text","value":"：用於運行需要完整 OS 的服務。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Containers (Podman)"}]},{"type":"text","value":"：用於運行輕量級應用。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最關鍵的是，我全面採用了 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Rootless"}]},{"type":"text","value":" 方案。\n這意味著不管是 libvirt 還是 Podman，都是以非 root 使用者身份運行。這在安全性上是一個巨大的提升，即使容器被攻破，攻擊者拿到的權限也受到極大限制。Cockpit 對 Rootless 的支援相當完善，讓我可以在 Web 介面上無痛管理這些隔離環境。"}]},{"type":"element","tag":"h1","props":{"id":"核心思想四注入靈魂-cockpit-copilot-llm-mcp"},"children":[{"type":"text","value":"核心思想四：注入靈魂 —— Cockpit Copilot (LLM + MCP)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這大概是 v2 架構最「Geek」也最讓我興奮的部分。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"光有好的架構還不夠，我希望管理伺服器這件事能更「現代化」。既然 LLM 這麼強大，為什麼我要自己去查 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"virsh"}]},{"type":"text","value":" 或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"podman"}]},{"type":"text","value":" 的冷門參數？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"於是，我自製了一個專案："},{"type":"element","tag":"strong","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/hans00/cockpit-copilot-agent","rel":["nofollow"]},"children":[{"type":"text","value":"cockpit-copilot-agent"}]}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這不只是一個聊天機器人，這是基於 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"MCP (Model Context Protocol)"}]},{"type":"text","value":" 打造的系統管理員助手："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"MCP 工具包"}]},{"type":"text","value":"：我將 Linux 系統管理工具封裝成 MCP tools。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"LLM 決策"}]},{"type":"text","value":"：透過語言模型理解我的自然語言指令（例如：「幫我把那個吃記憶體最兇的 Container 重啟」）。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"自動執行"}]},{"type":"text","value":"：Agent 會透過 MCP 安全地調用系統指令，並將結果回傳給我。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"以前我要 SSH 進去敲 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"podman stats"}]},{"type":"text","value":" 然後 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"podman restart <id>"}]},{"type":"text","value":"，現在我只需要在 Cockpit 裡跟我的 Copilot 說一句話。它不僅是介面，更是我的 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Sidecar Admin"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"vue-mermaid","props":{"code":"\ngraph TD\n User((User)) -->|Natural Language| Agent[Cockpit Copilot Agent]\n Agent -->|MCP Protocol| Tools[MCP Tools]\n Tools -->|Command| System[Ubuntu System]\n System --> Podman\n System --> Libvirt\n System --> ZFS\n subgraph Cockpit\n     Agent\n end\n"},"children":[]},{"type":"element","tag":"h1","props":{"id":"結語"},"children":[{"type":"text","value":"結語"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"HomeLab v2.0 不僅是一次硬體架構的縮減，更是一次管理思維的升級。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"從「多機堆疊」回歸到「單機極致」，從「手動維護」進化到「AI 輔助」。這套 Ubuntu + ZFS + Cockpit + AI Copilot 的組合，完美解決了我舊架構的功耗痛點，同時也讓系統管理變得前所未有的有趣。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果你也厭倦了維護龐大虛擬化叢集的疲憊感，或許這套 All-in-One 的智慧化方案，會是你下一個 HomeLab 的靈感來源。"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:articles:homelab-v2.md","_source":"content","_file":"articles/homelab-v2.md","_stem":"articles/homelab-v2","_extension":"md"}